{% extends "base.html" %}
{% block title %}リード一覧{% endblock %}
{% block content %}
<h1>リード一覧</h1>

<!-- Filter Section -->
<div class="filter-section">
    <form method="GET" action="{{ url_for('leads.list_leads') }}" class="filter-form" id="leadFilterForm">
        <!-- Search Fields -->
        <div class="filter-group-section">
            <div class="filter-group-header" onclick="toggleFilterGroup('search')">
                <span class="filter-group-icon" id="search-icon">▼</span>
                <h4>検索フィルター</h4>
            </div>
            <div class="filter-group-content" id="search-content">
                <div class="search-group">
            <div class="search-field">
                <label for="search_name">名前で検索:</label>
                <input type="text" name="search_name" id="search_name" 
                       value="{{ request.args.get('search_name', '') }}"
                       placeholder="顧客名を入力してください..."
                       class="search-input">
            </div>
            <div class="search-operator">
                <label for="search_operator">検索条件:</label>
                <select name="search_operator" id="search_operator">
                    <option value="AND" {% if request.args.get('search_operator') == 'AND' %}selected{% endif %}>AND</option>
                    <option value="OR" {% if request.args.get('search_operator') == 'OR' %}selected{% endif %}>OR</option>
                </select>
            </div>
            <div class="search-field">
                <label for="search_email">メールで検索:</label>
                <input type="text" name="search_email" id="search_email" 
                       value="{{ request.args.get('search_email', '') }}"
                       placeholder="メールアドレスを入力してください..."
                       class="search-input">
            </div>
            </div>
        </div>
        <!-- Advanced Filter Groups -->
        <div class="filter-group-section">
            <div class="filter-group-header" onclick="toggleFilterGroup('advanced')">
                <span class="filter-group-icon" id="advanced-icon">▼</span>
                <h4>高度なフィルター</h4>
            </div>
            <div class="filter-group-content" id="advanced-content">
                <div class="advanced-filters" id="advancedFilters">
            <h3>高度なフィルター</h3>
            <div id="filterGroups">
                <!-- Filter groups will be dynamically added here -->
            </div>
            <button type="button" class="btn btn-secondary" onclick="addFilterGroup()">フィルターグループを追加</button>
        </div>

        <script>
            let filterGroups = [];
            
            function addFilterGroup() {
                const groupId = Date.now();
                const group = {
                    id: groupId,
                    operator: 'AND',
                    conditions: []
                };
                filterGroups.push(group);
                renderFilterGroups();
            }
            
            function addCondition(groupId) {
                const group = filterGroups.find(g => g.id === groupId);
                if (group) {
                    group.conditions.push({
                        field: 'name',
                        operator: 'contains',
                        value: ''
                    });
                    renderFilterGroups();
                }
            }
            
            function removeCondition(groupId, index) {
                const group = filterGroups.find(g => g.id === groupId);
                if (group && group.conditions[index]) {
                    group.conditions.splice(index, 1);
                    renderFilterGroups();
                }
            }
            
            function removeGroup(groupId) {
                filterGroups = filterGroups.filter(g => g.id !== groupId);
                renderFilterGroups();
            }
            
            function updateGroupOperator(groupId, operator) {
                const group = filterGroups.find(g => g.id === groupId);
                if (group) {
                    group.operator = operator;
                }
            }
            
            function updateCondition(groupId, index, field, value) {
                const group = filterGroups.find(g => g.id === groupId);
                if (group && group.conditions[index]) {
                    group.conditions[index][field] = value;
                }
            }
            
            function renderFilterGroups() {
                const container = document.getElementById('filterGroups');
                container.innerHTML = filterGroups.map(group => `
                    <div class="filter-group" data-group-id="${group.id}">
                        <div class="group-header">
                            <select onchange="updateGroupOperator(${group.id}, this.value)">
                                <option value="AND" ${group.operator === 'AND' ? 'selected' : ''}>すべての条件に一致</option>
                                <option value="OR" ${group.operator === 'OR' ? 'selected' : ''}>いずれかの条件に一致</option>
                            </select>
                            <button type="button" class="btn btn-danger" onclick="removeGroup(${group.id})">グループを削除</button>
                        </div>
                        ${group.conditions.map((condition, index) => `
                            <div class="condition">
                                <select onchange="updateCondition(${group.id}, ${index}, 'field', this.value)">
                                    <option value="name" ${condition.field === 'name' ? 'selected' : ''}>名前</option>
                                    <option value="email" ${condition.field === 'email' ? 'selected' : ''}>メール</option>
                                    <option value="score" ${condition.field === 'score' ? 'selected' : ''}>スコア</option>
                                    <option value="status" ${condition.field === 'status' ? 'selected' : ''}>ステータス</option>
                                </select>
                                <select onchange="updateCondition(${group.id}, ${index}, 'operator', this.value)">
                                    ${condition.field === 'score' ? `
                                        <option value="equals" ${condition.operator === 'equals' ? 'selected' : ''}>一致する</option>
                                        <option value="greater_than" ${condition.operator === 'greater_than' ? 'selected' : ''}>より大きい</option>
                                        <option value="less_than" ${condition.operator === 'less_than' ? 'selected' : ''}>より小さい</option>
                                        <option value="greater_equal" ${condition.operator === 'greater_equal' ? 'selected' : ''}>以上</option>
                                        <option value="less_equal" ${condition.operator === 'less_equal' ? 'selected' : ''}>以下</option>
                                    ` : condition.field === 'status' ? `
                                        <option value="equals" ${condition.operator === 'equals' ? 'selected' : ''}>一致する</option>
                                        <option value="not_equals" ${condition.operator === 'not_equals' ? 'selected' : ''}>一致しない</option>
                                    ` : `
                                        <option value="contains" ${condition.operator === 'contains' ? 'selected' : ''}>含む</option>
                                        <option value="equals" ${condition.operator === 'equals' ? 'selected' : ''}>一致する</option>
                                        <option value="starts_with" ${condition.operator === 'starts_with' ? 'selected' : ''}>で始まる</option>
                                        <option value="ends_with" ${condition.operator === 'ends_with' ? 'selected' : ''}>で終わる</option>
                                    `}
                                </select>
                                <input type="text" value="${condition.value}" onchange="updateCondition(${group.id}, ${index}, 'value', this.value)" />
                                <button type="button" class="btn btn-danger" onclick="removeCondition(${group.id}, ${index})">削除</button>
                            </div>
                        `).join('')}
                        <button type="button" class="btn btn-secondary" onclick="addCondition(${group.id})">条件を追加</button>
                    </div>
                `).join('');
            }

            // Add filter_groups to form submission
            document.getElementById('leadFilterForm').addEventListener('submit', function(e) {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'filter_groups';
                input.value = JSON.stringify(filterGroups);
                this.appendChild(input);
            });
        </script>

        <style>
            /* Search field styles */
            .search-field {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin: 0.5rem 0;
            }

            .search-field label {
                min-width: 120px;
                margin-right: 0.5rem;
            }

            .search-input {
                flex: 1;
                padding: 0.5rem;
                border: 1px solid var(--border-color);
                border-radius: 4px;
            }

            /* Filter group styles */
            .filter-group-header {
                display: flex;
                align-items: center;
                cursor: pointer;
                padding: 0.8rem;
                background-color: var(--secondary-color);
                border-radius: 4px;
                margin-bottom: 0.5rem;
                transition: background-color 0.3s ease;
            }

            .filter-group-header:hover {
                background-color: var(--primary-color);
                color: white;
            }

            .filter-group-header h4 {
                margin: 0;
                flex-grow: 1;
            }

            .filter-group-icon {
                margin-right: 0.5rem;
            }

            .filter-group-content {
                padding: 1rem;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                margin-bottom: 1rem;
                display: none;
            }

            .filter-group-content.active {
                display: block;
            }

            .search-operator {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin: 0.5rem 0;
            }

            .search-operator select {
                padding: 0.5rem;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                background-color: white;
            }

            /* Advanced filters styles */
            .advanced-filters {
                margin-top: 1rem;
                padding: 1rem;
                background: var(--secondary-color);
                border-radius: 8px;
            }

            .filter-group {
                margin: 1rem 0;
                padding: 1rem;
                border: 1px solid var(--border-color);
                border-radius: 4px;
            }

            .group-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
            }

            .condition {
                display: flex;
                gap: 0.5rem;
                margin: 0.5rem 0;
                align-items: center;
            }

            .condition select,
            .condition input {
                padding: 0.5rem;
                border: 1px solid var(--border-color);
                border-radius: 4px;
            }
        </style>

        <script>
            // Add toggle functionality for filter groups
            function toggleFilterGroup(groupId) {
                const content = document.querySelector(`#${groupId}-content`);
                const icon = document.querySelector(`#${groupId}-icon`);
                
                // Toggle active class instead of directly setting display
                content.classList.toggle('active');
                
                // Update icon based on content visibility
                if (content.classList.contains('active')) {
                    icon.textContent = '▼';
                    content.style.display = 'block';
                } else {
                    icon.textContent = '▶';
                    content.style.display = 'none';
                }

                // Save state to localStorage
                localStorage.setItem(`filter-${groupId}-state`, content.classList.contains('active'));
            }

            // Initialize filter states on page load
            document.addEventListener('DOMContentLoaded', function() {
                const filterGroups = ['search', 'advanced', 'status', 'score', 'date', 'sort'];
                
                filterGroups.forEach(groupId => {
                    const content = document.querySelector(`#${groupId}-content`);
                    const icon = document.querySelector(`#${groupId}-icon`);
                    const savedState = localStorage.getItem(`filter-${groupId}-state`);
                    
                    if (savedState === 'true') {
                        content.classList.add('active');
                        content.style.display = 'block';
                        icon.textContent = '▼';
                    } else {
                        content.classList.remove('active');
                        content.style.display = 'none';
                        icon.textContent = '▶';
                    }
                });
            });
        </script>
        </div>

        <!-- Status Multi-select -->
        <div class="filter-group-section">
            <div class="filter-group-header" onclick="toggleFilterGroup('status')">
                <span class="filter-group-icon" id="status-icon">▼</span>
                <h4>ステータス フィルター</h4>
            </div>
            <div class="filter-group-content" id="status-content">
                <div class="filter-group">
                    <label>ステータス:</label>
                    <div class="status-checkboxes">
                <label>
                    <input type="checkbox" name="status" value="New" 
                           {% if 'New' in request.args.getlist('status') %}checked{% endif %}> 新規
                </label>
                <label>
                    <input type="checkbox" name="status" value="Contacted"
                           {% if 'Contacted' in request.args.getlist('status') %}checked{% endif %}> 連絡済み
                </label>
                <label>
                    <input type="checkbox" name="status" value="Qualified"
                           {% if 'Qualified' in request.args.getlist('status') %}checked{% endif %}> 適格
                </label>
                <label>
                    <input type="checkbox" name="status" value="Lost"
                           {% if 'Lost' in request.args.getlist('status') %}checked{% endif %}> 失注
                </label>
                <label>
                    <input type="checkbox" name="status" value="Spam"
                           {% if 'Spam' in request.args.getlist('status') %}checked{% endif %}> 迷惑メール
                </label>
                </div>
            </div>
        </div>
        </div>

        <!-- Score Range -->
        <div class="filter-group-section">
            <div class="filter-group-header" onclick="toggleFilterGroup('score')">
                <span class="filter-group-icon" id="score-icon">▼</span>
                <h4>スコア フィルター</h4>
            </div>
            <div class="filter-group-content" id="score-content">
                <div class="filter-group">
            <label>スコア範囲:</label>
            <div class="score-range">
                <input type="number" name="min_score" id="min_score" min="0" max="100" step="1" 
                       placeholder="最小" value="{{ request.args.get('min_score', '') }}">
                <span>～</span>
                <input type="number" name="max_score" id="max_score" min="0" max="100" step="1" 
                       placeholder="最大" value="{{ request.args.get('max_score', '') }}">
            </div>
            </div>
        </div>

        <!-- Date Range -->
        <div class="filter-group-section">
            <div class="filter-group-header" onclick="toggleFilterGroup('date')">
                <span class="filter-group-icon" id="date-icon">▼</span>
                <h4>日付 フィルター</h4>
            </div>
            <div class="filter-group-content" id="date-content">
                <div class="filter-group">
            <label>日付範囲:</label>
            <div class="date-range">
                <select name="date_field" id="date_field">
                    <option value="created_at" {% if request.args.get('date_field') == 'created_at' %}selected{% endif %}>作成日</option>
                    <option value="last_contact" {% if request.args.get('date_field') == 'last_contact' %}selected{% endif %}>最終接触日</option>
                </select>
                <input type="date" name="date_from" id="date_from" 
                       value="{{ request.args.get('date_from', '') }}">
                <span>～</span>
                <input type="date" name="date_to" id="date_to" 
                       value="{{ request.args.get('date_to', '') }}">
            </div>
            </div>
        </div>

        <!-- Sort Options -->
        <div class="filter-group-section">
            <div class="filter-group-header" onclick="toggleFilterGroup('sort')">
                <span class="filter-group-icon" id="sort-icon">▼</span>
                <h4>並び替え オプション</h4>
            </div>
            <div class="filter-group-content" id="sort-content">
                <div class="filter-group">
            <label>並び替え:</label>
            <div class="sort-options">
                <select name="sort_by" id="sort_by">
                    <option value="last_contact" {% if request.args.get('sort_by') == 'last_contact' %}selected{% endif %}>最終接触日</option>
                    <option value="name" {% if request.args.get('sort_by') == 'name' %}selected{% endif %}>名前</option>
                    <option value="email" {% if request.args.get('sort_by') == 'email' %}selected{% endif %}>メール</option>
                    <option value="score" {% if request.args.get('sort_by') == 'score' %}selected{% endif %}>スコア</option>
                    <option value="created_at" {% if request.args.get('sort_by') == 'created_at' %}selected{% endif %}>作成日</option>
                </select>
                <select name="sort_order" id="sort_order">
                    <option value="desc" {% if request.args.get('sort_order', 'desc') == 'desc' %}selected{% endif %}>降順</option>
                    <option value="asc" {% if request.args.get('sort_order') == 'asc' %}selected{% endif %}>昇順</option>
                </select>
            </div>
            </div>
        </div>
        <div class="filter-actions">
            <button type="submit" class="btn btn-primary">フィルター適用</button>
            <a href="{{ url_for('leads.list_leads') }}" class="btn btn-secondary">リセット</a>
            <button type="submit" name="save_filters" value="1" class="btn btn-success">フィルターを保存</button>
            {% if saved_filters %}
            <button type="button" class="btn btn-info" onclick="loadSavedFilters()">保存したフィルターを読み込む</button>
            {% endif %}
        </div>
    </form>
    <div class="action-buttons">
        <a href="{{ url_for('leads.update_empty_names') }}" class="btn btn-info">空の名前を更新</a>
    </div>
</div>

<script>
function loadSavedFilters() {
    const savedFilters = {{ saved_filters|tojson|safe }};
    const form = document.getElementById('leadFilterForm');
    
    if (savedFilters && savedFilters.leads) {
        const filters = savedFilters.leads;
        
        // Set text inputs
        form.querySelector('#search_name').value = filters.search_name || '';
        form.querySelector('#search_email').value = filters.search_email || '';
        form.querySelector('#search_operator').value = filters.search_operator || 'AND';
        
        // Set status checkboxes
        const statusCheckboxes = form.querySelectorAll('input[name="status"]');
        statusCheckboxes.forEach(checkbox => {
            checkbox.checked = filters.statuses && filters.statuses.includes(checkbox.value);
        });
        
        // Set score range
        form.querySelector('#min_score').value = filters.min_score || '';
        form.querySelector('#max_score').value = filters.max_score || '';
        
        // Set date range
        form.querySelector('#date_field').value = filters.date_field || 'created_at';
        form.querySelector('#date_from').value = filters.date_from || '';
        form.querySelector('#date_to').value = filters.date_to || '';
        
        // Set sort options
        form.querySelector('#sort_by').value = filters.sort_by || 'last_contact';
        form.querySelector('#sort_order').value = filters.sort_order || 'desc';
        
        // Submit the form to apply filters
        form.submit();
    }
}
</script>

<style>
.filter-section {
    background: var(--secondary-color);
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: var(--shadow);
    margin-bottom: 2rem;
}

.filter-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.search-group {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
}

.search-operator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.search-operator select {
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
}

.status-checkboxes {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.status-checkboxes label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.score-range {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.score-range input {
    width: 80px;
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
}

.date-range {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.date-range select,
.date-range input {
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
}

.sort-options {
    display: flex;
    gap: 0.5rem;
}

.sort-options select {
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
}

.filter-actions {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    flex-wrap: wrap;
}

.btn-success {
    background-color: var(--success-color);
    color: white;
}

.btn-success:hover {
    background-color: #218838;
}

@media (max-width: 768px) {
    .search-group,
    .status-checkboxes,
    .score-range,
    .date-range,
    .sort-options,
    .filter-actions {
        flex-direction: column;
        width: 100%;
    }
    
    .search-operator {
        width: 100%;
        justify-content: space-between;
    }
    
    .date-range select,
    .date-range input,
    .sort-options select {
        width: 100%;
    }
}
</style>

<!-- Bulk Operations Form -->
<form method="POST" action="{{ url_for('leads.bulk_action') }}" id="bulkForm">
    <div class="bulk-actions">
        <div class="select-all-container">
            <input type="checkbox" id="select-all" onclick="toggleAllCheckboxes()">
            <label for="select-all">すべて選択</label>
        </div>
        <select name="action" id="bulk-action">
            <option value="">一括操作を選択...</option>
            <option value="delete">削除</option>
            <option value="change_status">ステータス変更</option>
            <option value="update_score">スコア更新</option>
        </select>
        <select name="new_status" id="new-status" style="display: none;">
            <option value="New">新規</option>
            <option value="Contacted">連絡済み</option>
            <option value="Qualified">適格</option>
            <option value="Lost">失注</option>
            <option value="Spam">迷惑メール</option>
        </select>
        <input type="number" name="new_score" id="new-score" min="0" max="100" step="1" 
               placeholder="新しいスコア" style="display: none;">
        <button type="submit" class="btn btn-primary" onclick="return confirmBulkAction()">適用</button>
    </div>

<!-- Lead Grid -->
<div class="lead-grid">
    {% for lead in leads %}
    <div class="lead-card">
        <div class="lead-select">
            <input type="checkbox" name="selected_leads[]" value="{{ lead.id }}" class="lead-checkbox">
        </div>
        <h2>{{ lead.name or '名前なし' }}</h2>
        <p><strong>メール:</strong> {{ lead.email }}</p>
        <p><strong>電話:</strong> {{ lead.phone }}</p>
        <p><strong>ステータス:</strong> {{ lead.status }}</p>
        <p><strong>スコア:</strong> {{ "%.1f"|format(lead.score) }}</p>
        <p><strong>最終接触:</strong> {{ lead.last_contact.strftime('%Y-%m-%d %H:%M') if lead.last_contact }}</p>
        <div class="card-actions">
            <a href="{{ url_for('leads.edit_lead', id=lead.id) }}" class="btn btn-edit">編集</a>
            <form method="POST" action="{{ url_for('leads.delete_lead', id=lead.id) }}" style="display: inline;">
                <button type="submit" class="btn btn-delete" onclick="return confirm('このリードを削除してもよろしいですか？');">削除</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
</form>

<div class="add-lead">
    <a href="{{ url_for('leads.add_lead') }}" class="btn btn-add">新規リードを追加</a>
</div>

<script>
function toggleAllCheckboxes() {
    const selectAll = document.getElementById('select-all');
    const checkboxes = document.querySelectorAll('.lead-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
    });
}

document.getElementById('bulk-action').addEventListener('change', function() {
    const newStatusSelect = document.getElementById('new-status');
    const newScoreInput = document.getElementById('new-score');
    
    newStatusSelect.style.display = this.value === 'change_status' ? 'inline-block' : 'none';
    newScoreInput.style.display = this.value === 'update_score' ? 'inline-block' : 'none';
});

function confirmBulkAction() {
    const action = document.getElementById('bulk-action').value;
    const selectedLeads = document.querySelectorAll('input[name="selected_leads[]"]:checked').length;
    
    if (!action) {
        alert('操作を選択してください。');
        return false;
    }
    
    if (selectedLeads === 0) {
        alert('リードを選択してください。');
        return false;
    }
    
    if (action === 'delete') {
        return confirm(`選択された${selectedLeads}件のリードを削除してもよろしいですか？`);
    }
    
    if (action === 'update_score') {
        const newScore = document.getElementById('new-score').value;
        if (!newScore || newScore < 0 || newScore > 100) {
            alert('0から100の間のスコアを入力してください。');
            return false;
        }
    }
    
    return true;
}

// Update select-all checkbox state when individual checkboxes change
document.querySelectorAll('.lead-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('.lead-checkbox');
        const selectAll = document.getElementById('select-all');
        selectAll.checked = [...checkboxes].every(cb => cb.checked);
    });
});
</script>

<style>
:root {
    --primary-color: #4a90e2;
    --secondary-color: #f8f9fa;
    --border-color: #e1e4e8;
    --text-color: #2c3e50;
    --success-color: #28a745;
    --danger-color: #dc3545;
    --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

body {
    font-family: "Noto Sans JP", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    color: var(--text-color);
    line-height: 1.6;
}

.filter-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background-color: var(--secondary-color);
    border-radius: 8px;
    box-shadow: var(--shadow);
}

.search-group {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.search-field {
    display: flex;
    align-items: center;
    gap: 1rem;
    position: relative;
    flex: 1;
    min-width: 280px;
}

.search-field::before {
    content: "🔍";
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
    pointer-events: none;
}

.search-field input[type="text"] {
    padding: 0.8rem 1rem 0.8rem 2.5rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    width: 100%;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.search-field input[type="text"]:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
    outline: none;
}

.search-field label {
    white-space: nowrap;
    font-weight: 500;
    color: var(--text-color);
}

.filter-form {
    display: flex;
    gap: 1.5rem;
    align-items: center;
    flex-wrap: wrap;
}

.filter-group {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.filter-group select,
.filter-group input[type="number"] {
    padding: 0.6rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: 6px;
    background-color: white;
    min-width: 120px;
}

.lead-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.lead-card {
    background: white;
    border-radius: 10px;
    padding: 1.5rem;
    position: relative;
    box-shadow: var(--shadow);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: 1px solid var(--border-color);
}

.lead-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.lead-card h2 {
    font-size: 1.25rem;
    margin-bottom: 1rem;
    color: var(--text-color);
}

.lead-card p {
    margin: 0.5rem 0;
    line-height: 1.5;
}

.btn {
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.btn-primary {
    background-color: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background-color: #357abd;
}

.btn-danger {
    background-color: var(--danger-color);
    color: white;
}

.btn-danger:hover {
    background-color: #bd2130;
}

.btn-edit {
    background-color: var(--primary-color);
    color: white;
}

.btn-delete {
    background-color: var(--danger-color);
    color: white;
}

.card-actions {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    justify-content: flex-end;
}

.bulk-actions {
    margin: 1.5rem 0;
    padding: 1rem;
    background-color: var(--secondary-color);
    border-radius: 8px;
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
}

.select-all-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.lead-select {
    position: absolute;
    top: 1rem;
    right: 1rem;
}

#new-score {
    width: 100px;
}

/* アニメーション */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.lead-card {
    animation: fadeIn 0.3s ease-out;
}

/* 日本語フォントの最適化 */
.lead-card h2,
.lead-card p,
.search-field input::placeholder {
    font-feature-settings: "palt";
    text-align: justify;
}

/* レスポンシブデザイン */
@media (max-width: 768px) {
    .search-group {
        flex-direction: column;
    }
    
    .search-field {
        width: 100%;
    }
    
    .bulk-actions {
        flex-direction: column;
        align-items: stretch;
    }
}
</style>
{% endblock %}
