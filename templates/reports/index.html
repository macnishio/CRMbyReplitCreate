{% extends "base.html" %}
{% block title %}Reports{% endblock %}
{% block content %}
<h1>Reports</h1>

<h2>Advanced Analytics</h2>
<div class="analytics-summary">
    <div class="stat-card">
        <h3>Conversion Rate</h3>
        <p>{{ "%.2f"|format(conversion_rate) }}%</p>
    </div>
    <div class="stat-card">
        <h3>Average Deal Size</h3>
        <p>${{ "%.2f"|format(average_deal_size) }}</p>
    </div>
    <div class="stat-card">
        <h3>Sales Pipeline Value</h3>
        <p>${{ "%.2f"|format(sales_pipeline_value) }}</p>
    </div>
</div>

<h2>Lead Status</h2>
<div style="width: 80%; max-width: 600px; margin: auto;">
    <canvas id="leadStatusChart"></canvas>
</div>

<h2>Opportunity Stage</h2>
<div style="width: 80%; max-width: 600px; margin: auto;">
    <canvas id="opportunityStageChart"></canvas>
</div>

<h2>Account Industry</h2>
<div style="width: 80%; max-width: 600px; margin: auto;">
    <canvas id="accountIndustryChart"></canvas>
</div>

<h2>Lead Score Distribution</h2>
<div style="width: 80%; max-width: 600px; margin: auto;">
    <canvas id="leadScoreChart"></canvas>
</div>

<h2>Task Status Distribution</h2>
<div style="width: 80%; max-width: 600px; margin: auto;">
    <canvas id="taskStatusChart"></canvas>
</div>

<h2>Task Due Date Distribution</h2>
<div style="width: 80%; max-width: 600px; margin: auto;">
    <canvas id="taskDueDateChart"></canvas>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Lead Status Chart
    new Chart(document.getElementById('leadStatusChart'), {
        type: 'pie',
        data: {
            labels: {{ lead_status|map(attribute=0)|list|tojson }},
            datasets: [{
                data: {{ lead_status|map(attribute=1)|list|tojson }},
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                },
            },
            layout: {
                padding: {
                    left: 10,
                    right: 10,
                    top: 0,
                    bottom: 0
                }
            }
        }
    });

    // Opportunity Stage Chart
    new Chart(document.getElementById('opportunityStageChart'), {
        type: 'bar',
        data: {
            labels: {{ opportunity_stage|map(attribute=0)|list|tojson }},
            datasets: [{
                label: 'Count',
                data: {{ opportunity_stage|map(attribute=1)|list|tojson }},
                backgroundColor: '#36A2EB'
            }, {
                label: 'Amount',
                data: {{ opportunity_stage|map(attribute=2)|list|tojson }},
                backgroundColor: '#FFCE56',
                yAxisID: 'y-axis-2'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    type: 'linear',
                    position: 'left',
                    beginAtZero: true
                },
                'y-axis-2': {
                    type: 'linear',
                    position: 'right',
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                },
            },
            layout: {
                padding: {
                    left: 10,
                    right: 10,
                    top: 0,
                    bottom: 0
                }
            }
        }
    });

    // Account Industry Chart
    new Chart(document.getElementById('accountIndustryChart'), {
        type: 'doughnut',
        data: {
            labels: {{ account_industry|map(attribute=0)|list|tojson }},
            datasets: [{
                data: {{ account_industry|map(attribute=1)|list|tojson }},
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                },
            },
            layout: {
                padding: {
                    left: 10,
                    right: 10,
                    top: 0,
                    bottom: 0
                }
            }
        }
    });

    // Lead Score Distribution Chart
    new Chart(document.getElementById('leadScoreChart'), {
        type: 'bar',
        data: {
            labels: {{ lead_score_labels|tojson }},
            datasets: [{
                label: 'Number of Leads',
                data: {{ lead_score_data|tojson }},
                backgroundColor: '#4BC0C0'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                },
            },
            layout: {
                padding: {
                    left: 10,
                    right: 10,
                    top: 0,
                    bottom: 0
                }
            }
        }
    });

    // Task Status Distribution Chart
    new Chart(document.getElementById('taskStatusChart'), {
        type: 'pie',
        data: {
            labels: ['Completed', 'Not Completed'],
            datasets: [{
                data: {{ task_status|map(attribute=1)|list|tojson }},
                backgroundColor: ['#4BC0C0', '#FF6384']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                },
            },
            layout: {
                padding: {
                    left: 10,
                    right: 10,
                    top: 0,
                    bottom: 0
                }
            }
        }
    });

    // Task Due Date Distribution Chart
    new Chart(document.getElementById('taskDueDateChart'), {
        type: 'bar',
        data: {
            labels: {{ task_due_date|map(attribute=0)|list|tojson }},
            datasets: [{
                label: 'Number of Tasks',
                data: {{ task_due_date|map(attribute=1)|list|tojson }},
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                },
            },
            layout: {
                padding: {
                    left: 10,
                    right: 10,
                    top: 0,
                    bottom: 0
                }
            }
        }
    });
</script>
{% endblock %}
